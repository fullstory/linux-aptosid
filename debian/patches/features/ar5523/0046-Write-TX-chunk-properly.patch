From c0b242d525117aa0489a6de667fa778aceaa91f8 Mon Sep 17 00:00:00 2001
From: Pontus Fuchs <pontus.fuchs@gmail.com>
Date: Mon, 24 Sep 2012 22:06:26 +0200
Subject: [PATCH 46/73] Write TX chunk properly

Get rid of magic macro.
---
 drivers/net/wireless/ar5523.c |    9 +++++----
 drivers/net/wireless/ar5523.h |    2 --
 2 files changed, 5 insertions(+), 6 deletions(-)

--- a/drivers/net/wireless/ar5523.c
+++ b/drivers/net/wireless/ar5523.c
@@ -925,11 +925,11 @@ static void ar5523_tx_work_locked(struct
 {
 	struct ar5523_tx_data *data;
 	struct ar5523_tx_desc *desc;
+	struct ar5523_chunk *chunk;
 	struct ieee80211_tx_info *txi;
 	struct urb *urb;
 	struct sk_buff *skb;
 	int error = 0, paylen;
-	__be32 *hdr;
 	u32 txqid;
 	unsigned long flags;
 
@@ -963,10 +963,11 @@ static void ar5523_tx_work_locked(struct
 		data->urb = urb;
 
 		desc = (struct ar5523_tx_desc *)skb_push(skb, sizeof(*desc));
-		hdr = (__be32 *)skb_push(skb, sizeof(__be32));
+		chunk = (struct ar5523_chunk *)skb_push(skb, sizeof(*chunk));
 
-		/* fill Tx descriptor */
-		*hdr = AR5523_MAKECTL(1, skb->len - sizeof(__be32));
+		chunk->seqnum = 0;
+		chunk->flags = UATH_CFLAGS_FINAL;
+		chunk->length = cpu_to_be16(skb->len);
 
 		desc->msglen = cpu_to_be32(skb->len);
 		desc->msgid  = AR5523_DATA_ID;
--- a/drivers/net/wireless/ar5523.h
+++ b/drivers/net/wireless/ar5523.h
@@ -175,8 +175,6 @@ struct ar5523_rx_desc {
 	__be32	pad;		/* XXX? */
 } __packed;
 
-#define AR5523_MAKECTL(qid, len)	cpu_to_be32((qid) << 16 | (len))
-
 struct ar5523_tx_desc {
 	__be32	msglen;
 	__be32	msgid;		/* msg id (supplied by host) */
