From c67ced9acc95917d4678b087a7ad834797ddfe3c Mon Sep 17 00:00:00 2001
From: Pontus Fuchs <pontus.fuchs@gmail.com>
Date: Sat, 8 Sep 2012 21:09:50 +0200
Subject: [PATCH 26/77] Remove stat timer

Does not seem to be used.
---
 ar5523.c |   30 +-----------------------------
 1 file changed, 1 insertion(+), 29 deletions(-)

--- a/drivers/net/wireless/ar5523.c
+++ b/drivers/net/wireless/ar5523.c
@@ -158,9 +158,7 @@ struct ar5523 {
 
 	u8			serial[16];
 
-	struct timer_list	stat_timer;
 	struct completion	ready;
-	struct work_struct	stat_work;
 	struct work_struct	rx_refill_work;
 
 	int			rxbufsz;
@@ -565,22 +563,6 @@ static int ar5523_get_devcap(struct ar55
  * Helpers.
  */
 
-static void ar5523_stat_work(struct work_struct *work)
-{
-	struct ar5523 *ar = container_of(work, struct ar5523, stat_work);
-	/*
-	 * Send request for statistics asynchronously. The timer will be
-	 * restarted when we'll get the stats notification.
-	 */
-	ar5523_cmd_write(ar, WDCMSG_TARGET_GET_STATS, NULL, 0, 0);
-}
-
-static void ar5523_stat(unsigned long arg)
-{
-	struct ar5523 *ar = (struct ar5523 *)arg;
-	ieee80211_queue_work(ar->hw, &ar->stat_work);
-}
-
 static int ar5523_set_ledsteady(struct ar5523 *ar, int lednum, int ledmode)
 {
 	struct uath_cmd_ledsteady led;
@@ -1119,7 +1101,6 @@ static void ar5523_tx(struct ieee80211_h
 		goto out_free_urb;
 	}
 
-
 	atomic_inc(&ar->tx_data_queued);
 
 	return;
@@ -1340,12 +1321,8 @@ static void ar5523_bss_info_changed(stru
 		/* turn link LED on */
 		ar5523_set_ledsteady(ar, UATH_LED_LINK, UATH_LED_ON);
 
-		/* start statistics timer */
-//		mod_timer(&ar->stat_timer, jiffies + HZ);
-
-	} else {
+	} else
 		ar5523_set_ledsteady(ar, UATH_LED_LINK, UATH_LED_OFF);
-	}
 
 out_unlock:
 	mutex_unlock(&ar->mutex);
@@ -1675,7 +1652,6 @@ static int ar5523_probe(struct usb_inter
 	init_completion(&ar->ready);
 	atomic_set(&ar->tx_data_queued, 0);
 	atomic_set(&ar->rx_data_free_cnt, 0);
-	INIT_WORK(&ar->stat_work, ar5523_stat_work);
 	INIT_WORK(&ar->rx_refill_work, ar5523_rx_refill_work);
 
 	INIT_LIST_HEAD(&ar->rx_data_free);
@@ -1736,8 +1712,6 @@ static int ar5523_probe(struct usb_inter
 	ar5523_info(ar, "MAC/BBP AR5523, RF AR%c112\n",
 			(id->driver_info & AR5523_FLAG_ABG) ? '5' : '2');
 
-	setup_timer(&ar->stat_timer, ar5523_stat, (unsigned long)ar);
-
 	ar->vif = NULL;
 	hw->flags = IEEE80211_HW_RX_INCLUDES_FCS |
 		    IEEE80211_HW_SIGNAL_DBM |
@@ -1783,8 +1757,6 @@ static void ar5523_disconnect(struct usb
 
 	ieee80211_unregister_hw(hw);
 
-	del_timer_sync(&ar->stat_timer);
-
 	ar5523_cancel_rx_cmd(ar);
 	ar5523_free_tx_cmd(ar);
 	ar5523_free_rx_cmd(ar);
