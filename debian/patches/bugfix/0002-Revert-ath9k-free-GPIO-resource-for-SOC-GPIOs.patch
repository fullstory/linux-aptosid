From d05a75718c3be51769e90e67f27bf6512e9f093a Mon Sep 17 00:00:00 2001
From: Stefan Lippers-Hollmann <s.l-h@gmx.de>
Date: Sun, 17 Jul 2016 21:36:58 +0200
Subject: [PATCH 2/9] Revert "ath9k: free GPIO resource for SOC GPIOs"

This reverts commit db2221901fbded787daed153281ed875de489692.
---
 drivers/net/wireless/ath/ath9k/btcoex.c       | 10 ----------
 drivers/net/wireless/ath/ath9k/btcoex.h       |  1 -
 drivers/net/wireless/ath/ath9k/gpio.c         |  9 ---------
 drivers/net/wireless/ath/ath9k/htc_drv_gpio.c |  2 --
 drivers/net/wireless/ath/ath9k/hw.c           |  1 -
 5 files changed, 23 deletions(-)

--- a/drivers/net/wireless/ath/ath9k/btcoex.c
+++ b/drivers/net/wireless/ath/ath9k/btcoex.c
@@ -220,16 +220,6 @@ void ath9k_hw_btcoex_init_3wire(struct a
 }
 EXPORT_SYMBOL(ath9k_hw_btcoex_init_3wire);
 
-void ath9k_hw_btcoex_deinit(struct ath_hw *ah)
-{
-	struct ath_btcoex_hw *btcoex_hw = &ah->btcoex_hw;
-
-	ath9k_hw_gpio_free(ah, btcoex_hw->btactive_gpio);
-	ath9k_hw_gpio_free(ah, btcoex_hw->btpriority_gpio);
-	ath9k_hw_gpio_free(ah, btcoex_hw->wlanactive_gpio);
-}
-EXPORT_SYMBOL(ath9k_hw_btcoex_deinit);
-
 void ath9k_hw_btcoex_init_mci(struct ath_hw *ah)
 {
 	ah->btcoex_hw.mci.ready = false;
--- a/drivers/net/wireless/ath/ath9k/btcoex.h
+++ b/drivers/net/wireless/ath/ath9k/btcoex.h
@@ -124,7 +124,6 @@ struct ath_btcoex_hw {
 void ath9k_hw_btcoex_init_scheme(struct ath_hw *ah);
 void ath9k_hw_btcoex_init_2wire(struct ath_hw *ah);
 void ath9k_hw_btcoex_init_3wire(struct ath_hw *ah);
-void ath9k_hw_btcoex_deinit(struct ath_hw *ah);
 void ath9k_hw_btcoex_init_mci(struct ath_hw *ah);
 void ath9k_hw_init_btcoex_hw(struct ath_hw *ah, int qnum);
 void ath9k_hw_btcoex_set_weight(struct ath_hw *ah,
--- a/drivers/net/wireless/ath/ath9k/gpio.c
+++ b/drivers/net/wireless/ath/ath9k/gpio.c
@@ -67,8 +67,6 @@ void ath_deinit_leds(struct ath_softc *s
 
 	ath_led_brightness(&sc->led_cdev, LED_OFF);
 	led_classdev_unregister(&sc->led_cdev);
-
-	ath9k_hw_gpio_free(sc->sc_ah, sc->sc_ah->led_pin);
 }
 
 void ath_init_leds(struct ath_softc *sc)
@@ -402,13 +400,6 @@ void ath9k_deinit_btcoex(struct ath_soft
 
 	if (ath9k_hw_mci_is_enabled(ah))
 		ath_mci_cleanup(sc);
-	else {
-		enum ath_btcoex_scheme scheme = ath9k_hw_get_btcoex_scheme(ah);
-
-		if (scheme == ATH_BTCOEX_CFG_2WIRE ||
-		    scheme == ATH_BTCOEX_CFG_3WIRE)
-			ath9k_hw_btcoex_deinit(sc->sc_ah);
-	}
 }
 
 int ath9k_init_btcoex(struct ath_softc *sc)
--- a/drivers/net/wireless/ath/ath9k/htc_drv_gpio.c
+++ b/drivers/net/wireless/ath/ath9k/htc_drv_gpio.c
@@ -253,8 +253,6 @@ void ath9k_deinit_leds(struct ath9k_htc_
 	ath9k_led_brightness(&priv->led_cdev, LED_OFF);
 	led_classdev_unregister(&priv->led_cdev);
 	cancel_work_sync(&priv->led_work);
-
-	ath9k_hw_gpio_free(priv->ah, priv->ah->led_pin);
 }
 
 
--- a/drivers/net/wireless/ath/ath9k/hw.c
+++ b/drivers/net/wireless/ath/ath9k/hw.c
@@ -1585,7 +1585,6 @@ static void ath9k_hw_apply_gpio_override
 		ath9k_hw_gpio_request_out(ah, i, NULL,
 					  AR_GPIO_OUTPUT_MUX_AS_OUTPUT);
 		ath9k_hw_set_gpio(ah, i, !!(ah->gpio_val & BIT(i)));
-		ath9k_hw_gpio_free(ah, i);
 	}
 }
 
